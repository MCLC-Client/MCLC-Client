<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCLC - Developer Profile</title>
    <link rel="icon" type="image/png" href="resources/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1bd96a',
                        'primary-dark': '#14a34f',
                        surface: '#121212',
                        background: '#080808',
                    },
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>

<body class="bg-background text-gray-200 selection:bg-primary/30 antialiased">

    <!-- Navbar -->
    <nav class="fixed top-0 left-0 right-0 z-[100] transition-all duration-300 bg-background/80 backdrop-blur-md border-b border-white/5 h-20"
        id="navbar">
        <div class="max-w-7xl mx-auto px-6 lg:px-12 flex items-center justify-between h-full">
            <a href="index.html" class="flex items-center gap-3">
                <img src="resources/icon.png" alt="MCLC Logo" class="w-10 h-10 object-contain">
                <span class="text-2xl font-extrabold tracking-tighter text-white">MCLC</span>
            </a>

            <div class="hidden md:flex items-center gap-10">
                <a href="index.html" class="text-gray-400 hover:text-white font-bold transition-all">Home</a>
                <a href="extensions.html" class="text-gray-400 hover:text-white font-bold transition-all">Extensions</a>
                <a href="dashboard.html"
                    class="bg-white/5 hover:bg-white/10 text-white px-6 py-2.5 rounded-xl font-bold transition-all">Dashboard</a>
            </div>
        </div>
    </nav>

    <div class="pt-40 pb-20 px-6 max-w-5xl mx-auto">
        <!-- Profile Header -->
        <div class="flex flex-col items-center text-center mb-20">
            <div class="relative group mb-8">
                <div class="absolute inset-0 bg-primary/20 blur-3xl rounded-full opacity-50"></div>
                <img id="user-avatar" src="resources/icon.png"
                    class="relative w-40 h-40 rounded-full border-4 border-white/10 shadow-2xl object-cover">
            </div>
            <h1 id="user-name" class="text-6xl font-black text-white mb-4 tracking-tight">...</h1>
            <p id="user-bio" class="text-xl text-gray-400 max-w-2xl leading-relaxed">...</p>
            <div class="mt-8 flex gap-4 text-[10px] font-black uppercase tracking-[0.2em] text-gray-500">
                <span id="user-role">Member</span>
                <span>â€¢</span>
                <span id="user-joined">Joined ...</span>
            </div>
        </div>

        <!-- Contributions -->
        <h2 class="text-2xl font-black text-white mb-8 flex items-center gap-4">
            Contributions
            <span id="ext-count" class="text-xs bg-white/5 px-3 py-1 rounded-full text-gray-400">0</span>
        </h2>

        <div id="extensions-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Loaded via JS -->
            <div
                class="col-span-full py-20 text-center text-gray-600 font-bold border-2 border-dashed border-white/5 rounded-[2.5rem]">
                No extensions published by this user yet.
            </div>
        </div>
    </div>

    <script>
        async function loadUserProfile() {
            const params = new URLSearchParams(window.location.search);
            const username = params.get('u');
            if (!username) {
                window.location.href = 'index.html';
                return;
            }

            try {
                const res = await fetch(`/api/users/p/${username}`);
                if (!res.ok) throw new Error('Not found');
                const data = await res.json();

                const { user, extensions } = data;

                // Helper for paths
                const fixPath = (p) => p ? (p.startsWith('http') ? p : `/uploads/${p.replace(/^\/?uploads\//, '')}`) : 'resources/icon.png';

                // Update Profile
                const avatarUrl = fixPath(user.avatar);
                document.getElementById('user-avatar').src = avatarUrl;
                document.getElementById('user-name').textContent = user.username;
                document.getElementById('user-bio').textContent = user.bio || 'This developer has not set a biography yet.';
                document.getElementById('user-role').textContent = user.role === 'admin' ? 'Administrator' : 'Developer';
                document.getElementById('user-joined').textContent = `Joined ${new Date(user.created_at).toLocaleDateString('de-DE', { month: 'long', year: 'numeric' })}`;
                document.getElementById('ext-count').textContent = extensions.length;

                // Update Title
                document.title = `MCLC - ${user.username}'s Profile`;

                // Render Extensions
                if (extensions.length > 0) {
                    const grid = document.getElementById('extensions-grid');
                    grid.innerHTML = extensions.map(ext => `
                        <a href="/extensions/${ext.identifier}" class="group bg-surface/50 border border-white/5 p-4 rounded-[2rem] hover:border-primary/50 transition-all transform hover:-translate-y-1">
                            <div class="aspect-video rounded-2xl overflow-hidden mb-4 bg-background relative">
                                <img src="${fixPath(ext.banner_path)}" 
                                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                                <div class="absolute top-4 right-4 px-3 py-1 rounded-full bg-black/50 backdrop-blur-md text-[10px] font-black text-white uppercase tracking-widest border border-white/10">
                                    ${ext.type}
                                </div>
                            </div>
                            <div class="px-2">
                                <h3 class="text-xl font-bold text-white group-hover:text-primary transition-colors">${ext.name}</h3>
                                <p class="text-gray-500 text-sm mt-1 line-clamp-1">${ext.summary || ''}</p>
                            </div>
                        </a>
                    `).join('');
                }

            } catch (err) {
                console.error(err);
                document.body.innerHTML = '<div class="min-h-screen flex items-center justify-center text-white font-bold">User not found.</div>';
            }
        }

        document.addEventListener('DOMContentLoaded', loadUserProfile);
    </script>
    <script src="../main.js?v=4"></script>
</body>

</html>